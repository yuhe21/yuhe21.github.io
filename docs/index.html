<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Swagger UI with Vue.js Accordion</title>
    <link rel="stylesheet" type="text/css" href="./swagger-ui.css" />
    <link rel="stylesheet" type="text/css" href="./index.css" />
    <link rel="stylesheet" type="text/css" href="./custom_index.css" />
    <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
    <div id="app">
        <div class="accordion">
            <div class="accordion-item">
                <div class="accordion-header" @click="toggleAccordion">📂 API List</div>
                <div class="accordion-content" :class="{ show: isOpen }">
                    <ul>
                        <li v-for="file in apiFiles" :key="file">
                            <a href="" @click.prevent="loadSwagger(file)">{{ file }}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="swagger-container">
            <div id="swagger-ui-placeholder"></div>
        </div>
    </div>
    <script src="./swagger-ui-bundle.js" charset="UTF-8"></script>
    <script src="./swagger-ui-standalone-preset.js" charset="UTF-8"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    apiFiles: [],
                    isOpen: false // アコーディオンの開閉状態
                };
            },
            async created() {
                try {
                    const response = await fetch("./urls/index.json");
                    if (!response.ok) throw new Error("JSON fetch error");
                    const data = await response.json();
                    this.apiFiles = data.files
                } catch (error) {
                    console.error("Error fetching YAML files:", error);
                }
            },
            methods: {
                toggleAccordion() {
                    this.isOpen = !this.isOpen;
                },
                loadSwagger(file) {
                    const yamlUrl = `./openAPI/${file}`;
                    const container = document.getElementById("swagger-ui-placeholder");
                    container.innerHTML = "";
                    const swaggerDiv = document.createElement("div");
                    swaggerDiv.id = "swagger-ui";
                    container.appendChild(swaggerDiv);
                    window.ui = SwaggerUIBundle({
                        url: yamlUrl,
                        dom_id: "#swagger-ui",
                        presets: [
                            SwaggerUIBundle.presets.apis,
                            SwaggerUIStandalonePreset
                        ],
                        layout: "StandaloneLayout",
                    });
                    this.isOpen = false;
                }
            }
        }).mount("#app");
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            const yamlUrl = params.get("url");
            if (yamlUrl) {
                const container = document.getElementById("swagger-ui-placeholder");
                container.innerHTML = "";
                const swaggerDiv = document.createElement("div");
                swaggerDiv.id = "swagger-ui";
                container.appendChild(swaggerDiv);
                window.ui = SwaggerUIBundle({
                    url: yamlUrl,
                    dom_id: "#swagger-ui",
                    presets: [
                        SwaggerUIBundle.presets.apis,
                        SwaggerUIStandalonePreset
                    ],
                    layout: "StandaloneLayout",
                });
            }
        };
    </script>
</body>
</html>
